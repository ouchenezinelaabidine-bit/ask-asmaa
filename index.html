<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>اسأل الأستاذة أسماء | Math Helper</title>

<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#0b1220;
  color:#eef2ff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.app{
  width:min(900px,100%);
  background:#0f1a33;
  border-radius:18px;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
  overflow:hidden;
}
.header{
  padding:14px;
  border-bottom:1px solid rgba(255,255,255,.1);
  font-weight:800;
}
.chat{
  height:420px;
  overflow:auto;
  padding:14px;
}
.row{margin-bottom:12px}
.user .bubble{background:rgba(110,231,255,.18)}
.bot .bubble{background:rgba(167,139,250,.18)}
.bubble{
  padding:10px 12px;
  border-radius:14px;
  line-height:1.6;
}
.meta{
  font-size:12px;
  color:#a7b3d1;
  margin-top:4px;
}
.composer{
  display:flex;
  gap:10px;
  padding:12px;
  border-top:1px solid rgba(255,255,255,.1);
}
textarea{
  flex:1;
  resize:none;
  height:50px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.1);
  background:#0b1220;
  color:#fff;
  padding:10px;
}
button{
  border:0;
  border-radius:12px;
  padding:10px 16px;
  font-weight:800;
  cursor:pointer;
  background:linear-gradient(135deg,#6ee7ff,#a78bfa);
}
button:disabled{opacity:.5}
</style>
</head>

<body>
<div class="app">
  <div class="header">اسأل الأستاذة أسماء – رياضيات فقط</div>
  <div id="chat" class="chat"></div>
  <div class="composer">
    <textarea id="input" placeholder="اكتب سؤالك في الرياضيات..."></textarea>
    <button id="sendBtn">إرسال</button>
  </div>
</div>

<script>
const WORKER_URL = "https://ask-asmaa.ouchene-zinelaabidine.workers.dev";

const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

function addMsg(role,text){
  const row=document.createElement("div");
  row.className="row "+role;
  const b=document.createElement("div");
  b.className="bubble";
  b.textContent=text;
  const m=document.createElement("div");
  m.className="meta";
  m.textContent=new Date().toLocaleTimeString();
  row.appendChild(b);
  row.appendChild(m);
  chatEl.appendChild(row);
  chatEl.scrollTop=chatEl.scrollHeight;
  if(window.MathJax) MathJax.typesetPromise([b]);
}

async function sendMessage(){
  const msg=inputEl.value.trim();
  if(!msg) return;
  addMsg("user",msg);
  inputEl.value="";
  sendBtn.disabled=true;

  try{
    const res=await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg})
    });
    const raw=await res.text();
    let data;
    try{data=JSON.parse(raw)}catch{data={answer:raw}}
    addMsg("bot",(data.answer||"").trim()||"لا يوجد رد واضح.");
  }catch{
    addMsg("bot","تعذر الاتصال بالخادم.");
  }finally{
    sendBtn.disabled=false;
  }
}

sendBtn.onclick=sendMessage;
inputEl.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

addMsg("bot","أهلًا! اكتب سؤالك في الرياضيات.");
</script>
</body>
</html>
