<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ù‡Ø¯ÙŠ | Ù…Ù†ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</title>

<script>
window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>
:root{
  --bg:#071426;
  --panel:#0b1f3a;
  --panel2:#0f2a52;
  --line:rgba(255,255,255,.08);
  --text:#eaf2ff;
  --muted:#9fb3d9;
  --accent:#4da3ff;
  --me:#4da3ff;
  --bot:#132c52;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:linear-gradient(180deg,#061225,#071b33);
  color:var(--text);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:16px;
}
.app{
  width:min(1200px,100%);
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:16px;
}
@media(max-width:900px){
  .app{grid-template-columns:1fr}
}
.panel{
  background:var(--panel);
  border-radius:18px;
  box-shadow:0 30px 80px rgba(0,0,0,.6);
  overflow:hidden;
}
.header{
  padding:18px;
  border-bottom:1px solid var(--line);
}
.header h1{
  margin:0;
  font-size:20px;
  font-weight:800;
}
.header p{
  margin:6px 0 0;
  font-size:13px;
  color:var(--muted);
  line-height:1.6;
}
.side{
  padding:18px;
}
.note{
  background:var(--panel2);
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
.note h3{
  margin:0 0 8px;
  font-size:15px;
}
.note p{
  margin:0;
  font-size:13px;
  color:var(--muted);
  line-height:1.7;
}
.chatWrap{
  display:flex;
  flex-direction:column;
  height:100%;
}
.chat{
  flex:1;
  padding:18px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}
.msg{
  max-width:75%;
  padding:12px 14px;
  border-radius:16px;
  line-height:1.7;
  white-space:pre-wrap;
}
.me{
  align-self:flex-start;
  background:linear-gradient(135deg,#4da3ff,#6bb7ff);
  color:#041225;
}
.bot{
  align-self:flex-end;
  background:var(--bot);
  border:1px solid var(--line);
}
.meta{
  font-size:12px;
  color:var(--muted);
  margin-top:4px;
}
.typing{
  align-self:flex-end;
  font-size:13px;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:8px;
}
.dots span{
  width:6px;height:6px;
  background:var(--accent);
  border-radius:50%;
  display:inline-block;
  animation:blink 1.4s infinite both;
}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
@keyframes blink{
  0%,80%,100%{opacity:.2}
  40%{opacity:1}
}
.composer{
  border-top:1px solid var(--line);
  padding:14px;
}
textarea{
  width:100%;
  min-height:52px;
  max-height:140px;
  resize:none;
  border-radius:14px;
  border:1px solid var(--line);
  background:#061225;
  color:var(--text);
  padding:12px;
  font-size:15px;
  margin-bottom:10px;
}
.actions{
  display:flex;
  flex-direction:column;
  gap:8px;
}
button,label.upload{
  border:0;
  border-radius:12px;
  padding:10px 14px;
  font-weight:800;
  cursor:pointer;
  background:linear-gradient(135deg,#4da3ff,#6bb7ff);
  color:#041225;
  text-align:center;
}
.secondary{
  background:transparent;
  color:var(--text);
  border:1px solid var(--line);
}
label.upload input{display:none}
.preview{
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="app">

  <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± -->
  <div class="panel">
    <div class="header">
      <h1>Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ù‡Ø¯ÙŠ</h1>
      <p>Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø´Ø±Ø­ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø§Ø­ØªØ±Ø§ÙÙŠ.</p>
    </div>
    <div class="side">
      <div class="note">
        <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
        <p>
          â€¢ Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨ÙˆØ¶ÙˆØ­.<br>
          â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ùˆ LaTeX.<br>
          â€¢ Ø£Ø±Ø³Ù„ ØªÙ…Ø±ÙŠÙ†Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©.<br>
          â€¢ Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ø±Ø­ Ù…ÙØµÙ„ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.
        </p>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
  <div class="panel chatWrap">
    <div class="chat" id="chat"></div>

    <div class="composer">
      <textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù‡Ù†Ø§..."></textarea>

      <div class="actions">
        <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>

        <label class="upload secondary">
          â• Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠÙ† (ØµÙˆØ±Ø©)
          <input type="file" id="imageInput" accept="image/*">
        </label>

        <button id="clear" class="secondary">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>

        <div class="preview" id="preview"></div>
      </div>
    </div>
  </div>

</div>

<script>
const WORKER_URL = "https://ask-asmaa.ouchene-zinelaabidine.workers.dev";

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const clearBtn = document.getElementById("clear");
const imgInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");

function time(){
  return new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
}
function add(role,text){
  const msg=document.createElement("div");
  msg.className="msg "+role;
  msg.textContent=text;
  chat.appendChild(msg);
  const meta=document.createElement("div");
  meta.className="meta";
  meta.textContent=time();
  chat.appendChild(meta);
  chat.scrollTop=chat.scrollHeight;
  if(window.MathJax) MathJax.typesetPromise([msg]).catch(()=>{});
}

let typingEl=null;
function showTyping(){
  typingEl=document.createElement("div");
  typingEl.className="typing";
  typingEl.innerHTML=`Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø£Ø³Ù…Ø§Ø¡ ØªÙØ­Ø¶Ù‘Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© <span class="dots"><span></span><span></span><span></span></span>`;
  chat.appendChild(typingEl);
  chat.scrollTop=chat.scrollHeight;
}
function hideTyping(){
  if(typingEl){typingEl.remove(); typingEl=null;}
}

imgInput.onchange=()=>{
  if(imgInput.files[0]){
    preview.textContent = "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ØªÙ…Ø±ÙŠÙ† (Ø³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§).";
  }
};

async function send(){
  const q=input.value.trim();
  if(!q) return;
  add("me",q);
  input.value="";
  sendBtn.disabled=true;
  showTyping();

  try{
    const res=await fetch(WORKER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:q})
    });
    const raw=await res.text();
    let data;
    try{data=JSON.parse(raw)}catch{data={answer:raw}};
    hideTyping();
    add("bot",(data.answer||"").trim()||"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ ÙˆØ§Ø¶Ø­.");
  }catch{
    hideTyping();
    add("bot","ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
  }finally{
    sendBtn.disabled=false;
  }
}

sendBtn.onclick=send;
clearBtn.onclick=()=>{
  chat.innerHTML="";
  add("bot","ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯.");
};
input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();
    send();
  }
});

add("bot","Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒØŒ ØªÙØ¶Ù„ Ø¨Ø·Ø±Ø­ ØªÙ…Ø±ÙŠÙ†Ùƒ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.");
</script>
</body>
</html>
